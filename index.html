<!DOCTYPE html>
<html lang="ko">
<head>
    <meta name="google-site-verification" content="KV12NDhvoAM6yzUnY_3xbYJ62mGJkSfGxO3kkJ9W5Qg" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ëŒ€ì¶œëœë“œ - ì „êµ­ 1ë“± ëŒ€ì¶œ ì¤‘ê°œ í”Œë«í¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f3f7ff; color: #171717; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .main-premium { border: 2px solid #3675FF; box-shadow: 0 10px 30px rgba(54, 117, 255, 0.12); }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-marquee { display: inline-block; animation: marquee 25s linear infinite; white-space: nowrap; }
        .filter-shadow { box-shadow: 0 8px 30px rgba(0,0,0,0.06); }
        .filter-btn { background: white; border: 1px solid #E5E7EB; border-radius: 12px; padding: 12px 8px; font-weight: 700; text-align: center; cursor: pointer; transition: all 0.2s; font-size: 13px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; }
        .filter-btn.active { background: #3675FF; color: white; border-color: #3675FF; }
        .hidden { display: none; }
        .sticky-tabs { position: sticky; top: 60px; z-index: 40; background: white; border-bottom: 1px solid #eee; }
        input, select, textarea, button { font-size: 16px !important; }
        .social-btn { transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 800; }
        
        #page-detail .section { margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        #page-detail .section h3 { font-size: 18px; color: #555; margin-bottom: 15px; border-left: 4px solid #007bff; padding-left: 10px; font-weight: 900; }
        #page-detail .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; }
        #page-detail .detail-item { background: #f8f9fa; padding: 12px; border-radius: 8px;}
        #page-detail .detail-item label { display: block; font-size: 13px; color: #666; margin-bottom: 4px; font-weight: 700;}
        #page-detail .detail-item span { font-size: 15px; color: #333; }

        @media (min-width: 1024px) { /* Tailwind's 'lg' breakpoint */
            .main-layout-wrapper {
                max-width: 3450px; /* ì›¹ë²„ì „ ë°°ê²½ 1.5ë°° í™•ì¥ (2300px * 1.5) */
            }
            .main-content-area {
                width: 2986px; /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ ìƒˆë¡œìš´ ë„ˆë¹„ (3450 - 400 - 64) */
                max-width: 2986px;
            }
        }
    </style>
</head>
<body class="bg-[#f3f7ff]">
            <div class="flex justify-center main-layout-wrapper">
                <div class="hidden lg:block w-[200px] flex-shrink-0 mx-4">             <a href="https://stop.pmang.com/pmang-poker" target="_blank" class="sticky top-10"><img src="landing_pro/banners/pkaHK1696662054.jpg" alt="Left Banner Ad" width="200" height="500"></a>
        </div>

        <div class="max-w-3xl w-full bg-white shadow-2xl min-h-screen main-content-area">
            <nav class="glass sticky top-0 z-50 py-3 px-4 flex justify-between items-center h-[60px]">
        <h1 class="text-xl font-black text-blue-600 tracking-tighter italic cursor-pointer" onclick="showPage('main')">ëŒ€ì¶œëœë“œ</h1>
        <div class="flex items-center gap-2">
            <div class="relative flex items-center">
                <svg class="absolute left-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input type="text" placeholder="ëŒ€ì¶œìƒí’ˆ ê²€ìƒ‰" class="w-40 pl-8 p-2 bg-gray-100 rounded-lg text-sm font-medium outline-none focus:ring-2 focus:ring-blue-300 transition-all duration-200">
            </div>
            <button class="text-blue-600 font-bold px-3 py-1 text-sm border border-blue-600 rounded-lg" onclick="showPage('login')">ë¡œê·¸ì¸</button>

        </div>
    </nav>

    <div class="bg-gray-900 py-2 overflow-hidden border-b border-gray-800">
        <div class="animate-marquee text-white font-medium text-[11px]">
            <span class="text-yellow-400 font-bold px-2">[ì‹¤ì‹œê°„]</span> ì„œìš¸ ê°•ë‚¨êµ¬ ì´*ì„±ë‹˜ 500ë§Œì› ìŠ¹ì¸ ì™„ë£Œ! ğŸ‰ &nbsp;&nbsp;&nbsp;&nbsp;
            <span class="text-blue-400 font-bold px-2">[ì•ˆë‚´]</span> ì •ì‹ ì‚¬ì—…ì ì¸ì¦ì„ ì™„ë£Œí•œ ì—…ì²´ë§Œ í™œë™ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
    </div>

    <div id="page-main" class="page-content">
        <section class="py-10 px-5 bg-white border-b border-gray-100 text-center">
            <h1 class="text-2xl font-black text-gray-900 mb-2 leading-tight">ì „êµ­ <span class="text-blue-600 underline">ëŒ€ì¶œì—…ì²´ ë§¤ì¹­</span> 1ë“±</h1>
            <p class="text-gray-400 font-medium text-[11px] mb-8 italic">ì‚¬ìš©ì ë§ì¶¤ ì‹¤ì‹œê°„ ë¦¬ìŠ¤íŒ… ì„œë¹„ìŠ¤</p>
            <section class="px-5 py-8 grid grid-cols-4 gap-4 bg-white border-b border-gray-50 text-center text-gray-600">
                <div onclick="showPage('area')"><span class="text-2xl">ğŸ“</span><p class="text-[11px] font-bold mt-2">ì§€ì—­ë³„</p></div>
                <div onclick="showPage('type')"><span class="text-2xl">ğŸ¢</span><p class="text-[11px] font-bold mt-2">ì¢…ë¥˜ë³„</p></div>
                <div onclick="showPage('verify')"><span class="text-2xl">ğŸ”</span><p class="text-[11px] font-bold mt-2">ì´ì ê³„ì‚°ê¸°</p></div>
                <div onclick="showPage('ads')"><span class="text-2xl">ğŸ“¢</span><p class="text-[11px] font-bold mt-2 text-blue-600">ê´‘ê³ ë¬¸ì˜</p></div>
            </section>
            
            <div class="max-w-xl mx-auto bg-white p-4 rounded-[24px] filter-shadow border border-gray-50 text-left">
                <div class="mb-6">
                    <button onclick="toggleCategory('region')" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none text-sm font-bold focus:border-blue-600 transition flex justify-between items-center">
                        <span>ì§€ì—­ ì„ íƒ</span>
                        <svg id="region-arrow" class="w-4 h-4 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="region-buttons" class="hidden grid grid-cols-4 gap-2 mt-2">
                        <button onclick="updateSelection('region', 'ì „êµ­', this)" class="filter-btn">ì „êµ­</button>
                        <button onclick="updateSelection('region', 'ì„œìš¸', this)" class="filter-btn">ì„œìš¸</button>
                        <button onclick="updateSelection('region', 'ê²½ê¸°', this)" class="filter-btn">ê²½ê¸°</button>
                        <button onclick="updateSelection('region', 'ì¸ì²œ', this)" class="filter-btn">ì¸ì²œ</button>
                        <button onclick="updateSelection('region', 'ë¶€ì‚°', this)" class="filter-btn">ë¶€ì‚°</button>
                        <button onclick="updateSelection('region', 'ëŒ€êµ¬', this)" class="filter-btn">ëŒ€êµ¬</button>
                        <button onclick="updateSelection('region', 'ê´‘ì£¼', this)" class="filter-btn">ê´‘ì£¼</button>
                        <button onclick="updateSelection('region', 'ëŒ€ì „', this)" class="filter-btn">ëŒ€ì „</button>
                    </div>
                </div>
                <div>
                    <button onclick="toggleCategory('loantype')" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none text-sm font-bold focus:border-blue-600 transition flex justify-between items-center">
                        <span>ìƒí’ˆ ì„ íƒ</span>
                        <svg id="loantype-arrow" class="w-4 h-4 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="loantype-buttons" class="hidden grid grid-cols-3 gap-2 mt-2">
                        <button onclick="updateSelection('loantype', 'ì†Œì•¡ëŒ€ì¶œ', this)" class="filter-btn"><span>ğŸ¢</span><span>ì†Œì•¡ëŒ€ì¶œ</span></button>
                        <button onclick="updateSelection('loantype', 'ì§ì¥ì¸', this)" class="filter-btn"><span>ğŸ‘¨â€ğŸ’¼</span><span>ì§ì¥ì¸</span></button>
                        <button onclick="updateSelection('loantype', 'ì‚¬ì—…ì', this)" class="filter-btn"><span>ğŸ›ï¸</span><span>ì‚¬ì—…ì</span></button>
                        <button onclick="updateSelection('loantype', 'ì €ì‹ ìš©', this)" class="filter-btn"><span>ğŸ“ˆ</span><span>ì €ì‹ ìš©</span></button>
                        <button onclick="updateSelection('loantype', 'ë‹¹ì¼ëŒ€ì¶œ', this)" class="filter-btn"><span>ğŸ“…</span><span>ë‹¹ì¼ëŒ€ì¶œ</span></button>
                    </div>
                </div>
                <div id="main-results-container" class="mt-8 space-y-3 hidden"></div>
            </div>
        </section>

        <section class="max-w-7xl mx-auto py-12 px-5 text-left">
            <h2 class="text-xl font-black text-gray-900 italic mb-6">â­ ë©”ì¸ ë“±ë¡ì—…ì²´</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="main-ads-container"></div>
        </section>

        <section class="bg-gray-50 py-12 px-5 pb-24 text-left">
            <h2 class="text-xl font-black text-gray-900 mb-6 italic flex items-center gap-2">
                <span class="bg-red-500 w-1.5 h-1.5 rounded-full animate-pulse"></span> ì‹¤ì‹œê°„ ëŒ€ì¶œë¬¸ì˜
            </h2>
            <div class="bg-white rounded-[24px] shadow-sm overflow-hidden border border-gray-100 divide-y font-bold text-sm" id="main-inquiry-container"></div>
        </section>
    </div>

    <div id="page-detail" class="page-content hidden bg-white min-h-screen p-6"></div>

    <div id="page-login" class="page-content hidden bg-white min-h-[calc(100vh-60px)] flex flex-col items-center justify-center px-6 pb-24">
        <div class="max-w-[400px] w-full text-center">
            <h2 class="text-3xl font-black text-blue-600 mb-10 italic uppercase tracking-tighter">Login</h2>
            
            <div class="space-y-3 mb-4">
                <input type="text" placeholder="ì•„ì´ë””" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none text-sm font-bold focus:border-blue-600 transition">
                <input type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full p-4 bg-gray-50 border rounded-2xl outline-none text-sm font-bold focus:border-blue-600 transition">
                
                <div class="flex items-center px-2 py-1">
                    <input type="checkbox" id="saveId" class="w-4 h-4 text-blue-600 border-gray-300 rounded">
                    <label for="saveId" class="ml-2 text-xs font-bold text-gray-500 cursor-pointer">ì•„ì´ë”” ì €ì¥</label>
                </div>

                <button class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black shadow-md mt-2 active:scale-95 transition">ë¡œê·¸ì¸</button>
            </div>

            <div class="flex flex-col gap-4 mt-6">
                <div class="flex justify-center gap-6 text-[12px] font-bold text-gray-400">
                    <button onclick="alert('ì•„ì´ë”” ì°¾ê¸°')">ì•„ì´ë”” ì°¾ê¸°</button><span class="text-gray-200">|</span><button onclick="alert('ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°')">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
                </div>
                <button onclick="showPage('register')" class="w-full border border-blue-600 text-blue-600 py-4 rounded-2xl font-black text-sm active:bg-blue-50 transition">íšŒì›ê°€ì…</button>
            </div>

            <div class="relative py-8 flex items-center justify-center">
                <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-100"></div></div>
                <span class="relative bg-white px-4 text-[10px] font-black text-gray-300 uppercase tracking-widest">Social Login</span>
            </div>

            <div class="space-y-2">
                <button class="social-btn w-full bg-[#FEE500] text-[#3c1e1e] py-4 rounded-2xl text-sm" onclick="window.location.href='https://kauth.kakao.com'"><span class="text-lg">ğŸ’¬</span> ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</button>
                <button class="social-btn w-full bg-[#03C75A] text-white py-4 rounded-2xl text-sm" onclick="window.location.href='https://nid.naver.com'"><span class="font-black">N</span> ë„¤ì´ë²„ ë¡œê·¸ì¸</button>
                <button class="social-btn w-full bg-white border border-gray-200 text-gray-700 py-4 rounded-2xl text-sm" onclick="window.location.href='https://accounts.google.com'"><span class="text-lg">G</span> êµ¬ê¸€ ë¡œê·¸ì¸</button>
            </div>
        </div>
    </div>

    <div id="page-list" class="page-content hidden bg-[#F4F7FA] pb-24 text-left">
        <div class="sticky-tabs flex justify-around py-3 px-4 shadow-sm">
            <button id="tab-area" onclick="showPage('area')" class="text-sm font-bold text-gray-400 pb-1">ì§€ì—­ë³„</button>
            <button id="tab-type" onclick="showPage('type')" class="text-sm font-bold text-gray-400 pb-1">ì¢…ë¥˜ë³„</button>
            <button id="tab-verify" onclick="showPage('verify')" class="text-sm font-bold text-gray-400 pb-1">ì´ì ê³„ì‚°ê¸°</button>
        </div>
        <section class="py-8 px-5">
            <h2 id="list-title" class="text-2xl font-black italic mb-6">ğŸ“ ë¦¬ìŠ¤íŠ¸ í™•ì¸</h2>
            <div id="list-filters" class="grid grid-cols-3 gap-2 mb-8"></div>
            <div id="list-container" class="space-y-3"></div>
        </section>
    </div>

    <div id="page-cs" class="page-content hidden bg-white min-h-screen pb-24 text-left">
        <section class="py-10 px-6 max-w-xl mx-auto">
            <h2 class="text-2xl font-black mb-6 italic text-blue-600">ğŸ“ ì‹¤ì‹œê°„ ë¬¸ì˜ë“±ë¡</h2>
            <div class="space-y-4 bg-gray-50 p-6 rounded-[28px] border border-gray-100">
                <input type="text" id="cs-title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full p-4 bg-white rounded-xl font-bold text-sm outline-none border focus:border-blue-600">
                <textarea id="cs-content" rows="6" placeholder="í¬ë§ ì§€ì—­, ê¸ˆì•¡, ì—°ë½ì²˜ ë“± ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full p-4 bg-white rounded-xl font-bold text-sm outline-none border focus:border-blue-600"></textarea>
                <button onclick="submitCsInquiry()" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black shadow-lg">ë¬¸ì˜ ë“±ë¡í•˜ê¸°</button>
            </div>
        </section>
    </div>

    <div id="page-register" class="page-content hidden bg-white pb-24 text-left"><section class="py-12 px-6 max-w-xl mx-auto"><h2 class="text-2xl font-black mb-10 italic">ì—…ì²´ íšŒì›ê°€ì…</h2><div class="space-y-6"><label class="font-black text-sm block">í•¸ë“œí° ì¸ì¦</label><div class="flex gap-2"><input type="tel" placeholder="010-0000-0000" class="flex-1 p-4 bg-gray-50 rounded-xl outline-none font-bold text-sm"><button class="bg-blue-600 text-white px-4 py-2 rounded-xl font-bold text-xs">ì¸ì¦ìš”ì²­</button></div><button class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black text-lg mt-6">ê°€ì… ì™„ë£Œ</button></div></section></div>
    <div id="page-ads" class="page-content hidden bg-white pb-24 text-left"><section class="py-10 px-6 max-w-xl mx-auto"><h2 class="text-2xl font-black mb-8 italic text-blue-600">AD Inquiry</h2><div class="bg-gray-50 p-6 rounded-[28px] border border-gray-100">
                        <input type="text" id="ad-company" placeholder="ì—…ì²´ëª…" class="w-full p-4 bg-white border-none rounded-xl mb-3 outline-none font-bold text-sm">
                        <input type="text" id="ad-name" placeholder="ë‹´ë‹¹ì ì„±í•¨" class="w-full p-4 bg-white border-none rounded-xl mb-3 outline-none font-bold text-sm">
                        <input type="email" id="ad-email" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" class="w-full p-4 bg-white border-none rounded-xl mb-3 outline-none font-bold text-sm">
                        <input type="tel" id="ad-phone" placeholder="ì—°ë½ì²˜" class="w-full p-4 bg-white border-none rounded-xl mb-3 outline-none font-bold text-sm">
                        <textarea id="ad-content" rows="4" placeholder="ë¬¸ì˜ ë‚´ìš©" class="w-full p-4 bg-white border-none rounded-xl mb-3 outline-none font-bold text-sm"></textarea>
                        <button onclick="submitAdInquiry()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black">ì‹ ì²­í•˜ê¸°</button>
                    </div></section></div>

    <div id="bottom-bar" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-5 py-3 flex gap-3 z-50 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        <button class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-black text-sm shadow-md" onclick="window.location.href='tel:1588-0000'">ì‹¤ì‹œê°„ ì „í™”ìƒë‹´</button>
        <button class="flex-[0.5] bg-yellow-400 text-yellow-900 py-4 rounded-xl font-black text-sm" onclick="showPage('cs')">ë¬¸ì˜ë“±ë¡</button>
    </div>

    <template id="item-temp">
        <div class="bg-white border border-gray-100 rounded-[24px] p-5 shadow-sm text-left cursor-pointer hover:shadow-lg transition-shadow">
            <div class="flex items-center gap-2 mb-1"><span class="bg-blue-50 text-blue-600 text-[9px] font-black px-2 py-0.5 rounded tracking-tighter uppercase font-black">Verified</span><h3 class="text-base font-black">ì—ì´ìŠ¤ ëŒ€ì¶œì¤‘ê°œ</h3></div>
            <p class="text-[10px] text-gray-400 font-bold mb-4 italic">ì „êµ­ ë¹„ëŒ€ë©´ ë‹¹ì¼ ì „ë¬¸</p>
            <div class="flex justify-between items-center font-black italic mb-4 text-sm px-2">
                <div><span class="text-[9px] text-gray-400 not-italic block uppercase">Limit</span>5,000ë§Œ</div>
                <div class="text-right text-blue-600"><span class="text-[9px] text-gray-400 not-italic block uppercase">Rate</span>ì—° 4.5%~</div>
            </div>
        </div>
    </template>

    <footer class="bg-white py-12 px-5 text-center border-t border-gray-100 mb-16">
        <h2 class="text-lg font-black text-blue-600 italic mb-4 cursor-pointer" onclick="showPage('main')">ëŒ€ì¶œëœë“œ</h2>
        <p class="text-[9px] text-gray-300 uppercase tracking-widest">Â© 2026 ëŒ€ì¶œëœë“œ. All Rights Reserved.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc as firestoreDoc, query, orderBy, where, limit as firestoreLimit } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAYd6PZFWAoXDnz80l_1-0EDtkDxAkQFy4",
            authDomain: "laos-project-ff295.firebaseapp.com",
            projectId: "laos-project-ff295",
            storageBucket: "laos-project-ff295.firebasestorage.app",
            messagingSenderId: "7764846397",
            appId: "1:7764846397:web:8977b486e092c0f7d24754",
            measurementId: "G-LMD3B020W7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let selectedRegion = null;
        let selectedLoanType = null;

        function toggleCategory(category) {
            const buttonContainer = document.getElementById(category + '-buttons');
            const arrow = document.getElementById(category + '-arrow');
            if (buttonContainer) {
                buttonContainer.classList.toggle('hidden');
                if (arrow) {
                    arrow.classList.toggle('rotate-180');
                }
            }
        }

        function updateSelection(group, value, element) {
            const buttonGroup = element.parentElement;
            const mainButton = buttonGroup.previousElementSibling;
            const mainButtonText = mainButton.querySelector('span');
            
            if (group === 'region') {
                if (selectedRegion === value) {
                    selectedRegion = null;
                    element.classList.remove('active');
                    mainButtonText.innerText = 'ì§€ì—­ ì„ íƒ';
                } else {
                    selectedRegion = value;
                    buttonGroup.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    element.classList.add('active');
                    mainButtonText.innerText = value;
                }
            } else if (group === 'loantype') {
                if (selectedLoanType === value) {
                    selectedLoanType = null;
                    element.classList.remove('active');
                    mainButtonText.innerText = 'ìƒí’ˆ ì„ íƒ';
                } else {
                    selectedLoanType = value;
                    buttonGroup.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    element.classList.add('active');
                    mainButtonText.innerText = value;
                }
            }

            // Close the dropdown after selection
            toggleCategory(group);
            
            showResults();
        }

        async function showResults() {
            const container = document.getElementById('main-results-container');
            
            if (selectedRegion && selectedLoanType) {
                container.innerHTML = '<p class="text-center text-gray-500 py-4">ë§ì¶¤ ìƒí’ˆì„ ì°¾ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
                container.classList.remove('hidden');
                
                try {
                    const adsCollection = collection(db, "ads");
                    const q = query(adsCollection, 
                                    where("region", "==", selectedRegion), 
                                    where("loan_type", "==", selectedLoanType),
                                    orderBy("created_at", "desc"));
                    const querySnapshot = await getDocs(q);

                    const title = document.createElement('h4');
                    title.className = 'text-center font-bold text-blue-600 py-2';
                    title.innerText = `'${selectedRegion}' X '${selectedLoanType}' ë§ì¶¤ ì¶”ì²œ!`;
                    
                    container.innerHTML = '';
                    container.appendChild(title);
                    renderAds(querySnapshot, container, false);

                } catch(e) {
                    console.error("ë§ì¶¤ ìƒí’ˆ ê²€ìƒ‰ ì‹¤íŒ¨: ", e);
                    container.innerHTML = '';
                    const title = document.createElement('h4');
                    title.className = 'text-center font-bold text-blue-600 py-2';
                    title.innerText = `'${selectedRegion}' X '${selectedLoanType}' ë§ì¶¤ ì¶”ì²œ!`;
                    container.appendChild(title);
                    let errorMsg = '<p class="text-center text-red-500">ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                    if (e.code === 'failed-precondition') {
                        errorMsg += '<p class="text-center text-xs text-gray-600 mt-2">ì´ í•„í„°ë§ì„ ì‚¬ìš©í•˜ë ¤ë©´ Firestore ë°ì´í„°ë² ì´ìŠ¤ì— ìƒ‰ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê°œë°œì ì½˜ì†”(F12)ì„ ì—´ì–´ ì˜¤ë¥˜ ë©”ì‹œì§€ì— í¬í•¨ëœ ìƒ‰ì¸ ìƒì„± ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ìƒ‰ì¸ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.</p>'
                    }
                    container.innerHTML += errorMsg;
                }

            } else {
                container.classList.add('hidden');
                container.innerHTML = '';
            }
        }
        
        // Internal function to render the page content based on pageId and detailId
        function _renderPage(pageId, detailId = null) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById('bottom-bar').classList.remove('hidden');

            const listPages = ['area', 'type', 'verify'];
            
            if (pageId === 'detail') {
                document.getElementById('page-detail').classList.remove('hidden');
                document.getElementById('bottom-bar').classList.add('hidden');
                loadAdDetail(detailId);
            } else if (listPages.includes(pageId)) {
                document.getElementById('page-list').classList.remove('hidden');
                updateTabs(pageId);
                setupListing(pageId);
            } else {
                const pageElement = document.getElementById(`page-${pageId}`);
                if (pageElement) {
                    pageElement.classList.remove('hidden');
                }
            }

            if (pageId === 'main') {
                initMain();
            }
            window.scrollTo(0, 0);
        }

        // Public function to navigate between pages and manage browser history
        function showPage(pageId, detailId = null, pushState = true) {
            const url = `#${pageId}${detailId ? '/' + detailId : ''}`;
            if (pushState) {
                history.pushState({ pageId: pageId, detailId: detailId }, '', url);
            }
            _renderPage(pageId, detailId);
        }

        // Event listener for browser's back/forward buttons
        window.addEventListener('popstate', (event) => {
            if (event.state) {
                _renderPage(event.state.pageId, event.state.detailId);
            } else {
                // If no state, default to main page
                _renderPage('main');
            }
        });

        function updateTabs(activeId) {
            ['area', 'type', 'verify'].forEach(id => {
                const tab = document.getElementById('tab-' + id);
                if (id === activeId) { tab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600'); tab.classList.remove('text-gray-400'); } 
                else { tab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600'); tab.classList.add('text-gray-400'); }
            });
        }
        
        function renderAds(querySnapshot, container, shouldClear = true) {
            if (shouldClear) {
                container.innerHTML = '';
            }
            const template = document.getElementById('item-temp');

            if (querySnapshot.empty) {
                container.innerHTML += '<p class="text-center text-gray-500 py-8">í•´ë‹¹ ì¡°ê±´ì˜ ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            querySnapshot.forEach(doc => {
                const ad = doc.data();
                const clone = template.content.cloneNode(true);
                const adItem = clone.querySelector('.bg-white');

                adItem.onclick = () => showPage('detail', doc.id);
                
                clone.querySelector('h3').textContent = ad.company_name || 'ì •ë³´ ì—†ìŒ';
                clone.querySelector('p').textContent = ad.title || 'ì •ë³´ ì—†ìŒ';
                
                const limitDiv = clone.querySelector('.flex.justify-between > div:first-child');
                limitDiv.innerHTML = `<span class="text-[9px] text-gray-400 not-italic block uppercase">Limit</span>${ad.limit || 'ì •ë³´ ì—†ìŒ'}`;

                const rateDiv = clone.querySelector('div.text-right');
                rateDiv.innerHTML = `<span class="text-[9px] text-gray-400 not-italic block uppercase">Rate</span>${ad.yearly_rate || 'ì •ë³´ ì—†ìŒ'}`;


                container.appendChild(clone);
            });
        }

        async function loadAdDetail(adId) {
            const detailContainer = document.getElementById('page-detail');
            detailContainer.innerHTML = '<p class="text-center text-gray-500 py-20">ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';

            if (!adId) {
                detailContainer.innerHTML = '<p class="text-center text-red-500 py-20">ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.</p>';
                return;
            }

            try {
                const docRef = firestoreDoc(db, "ads", adId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const ad = docSnap.data();
                    detailContainer.innerHTML = `
                        <div class="pb-24">
                            <h2 class="text-3xl font-black text-gray-900 mb-4">${ad.title}</h2>
                            
                            <div class="section">
                                <h3>ğŸ¢ ì—…ì²´ì •ë³´</h3>
                                <div class="detail-grid">
                                    <div class="detail-item"><label>ì—…ì²´ëª…</label><span>${ad.company_name || ''}</span></div>
                                    <div class="detail-item"><label>ì—°ë½ì²˜</label><span>${ad.phone || ''}</span></div>
                                    <div class="detail-item"><label>ë“±ë¡ë²ˆí˜¸</label><span>${ad.reg_number || ''}</span></div>
                                    <div class="detail-item"><label>ë“±ë¡ê¸°ê´€</label><span>${ad.agency || ''}</span></div>
                                    <div class="detail-item col-span-full"><label>ì˜ì—…ì†Œ ì£¼ì†Œ</label><span>${ad.address || ''}</span></div>
                                </div>
                            </div>

                            <div class="section">
                                <h3>ğŸ’° ìƒí’ˆì •ë³´</h3>
                                <div class="detail-grid">
                                    <div class="detail-item"><label>ëŒ€ì¶œí•œë„</label><span>${ad.limit || ''}</span></div>
                                    <div class="detail-item"><label>ì—° ê¸ˆë¦¬</label><span>${ad.yearly_rate || ''}</span></div>
                                    <div class="detail-item"><label>ì›” ê¸ˆë¦¬</label><span>${ad.monthly_rate || ''}</span></div>
                                    <div class="detail-item"><label>ìƒí™˜ê¸°ê°„</label><span>${ad.period || ''}</span></div>
                                    <div class="detail-item"><label>ìƒí™˜ë°©ì‹</label><span>${ad.repayment || ''}</span></div>
                                    <div class="detail-item"><label>ì—°ì²´ê¸ˆë¦¬</label><span>${ad.overdue_rate || ''}</span></div>
                                    <div class="detail-item"><label>ì¶”ê°€ë¹„ìš©</label><span>${ad.extra_fee || ''}</span></div>
                                    <div class="detail-item"><label>ì¤‘ë„ìƒí™˜ìˆ˜ìˆ˜ë£Œ</label><span>${ad.prepay_fee || ''}</span></div>
                                    <div class="detail-item"><label>ê°€ëŠ¥ ì§€ì—­</label><span>${ad.region || ''}</span></div>
                                    <div class="detail-item"><label>ìƒí’ˆ ì¢…ë¥˜</label><span>${ad.loan_type || ''}</span></div>
                                </div>
                            </div>
                            <button onclick="history.back()" class="w-full bg-gray-700 text-white py-4 rounded-xl font-black mt-8 shadow-lg">ë’¤ë¡œê°€ê¸°</button>
                        </div>
                    `;
                } else {
                    detailContainer.innerHTML = '<p class="text-center text-red-500 py-20">í•´ë‹¹ ê´‘ê³ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } catch (e) {
                console.error("ìƒì„¸ ì •ë³´ ë¡œë”© ì‹¤íŒ¨: ", e);
                detailContainer.innerHTML = '<p class="text-center text-red-500 py-20">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        async function setupListing(type) {
            const container = document.getElementById('list-container');
            const filters = document.getElementById('list-filters');
            document.getElementById('list-title').innerText = type==='area'?'ğŸ“ ì§€ì—­ë³„ ì°¾ê¸°':type==='type'?'ğŸ¢ ì¢…ë¥˜ë³„ ì°¾ê¸°':'ğŸ” ì´ì ê³„ì‚°ê¸°';
            container.innerHTML = '<p class="text-center text-gray-500 py-8">ìƒë‹¨ì—ì„œ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>';
            filters.innerHTML = '';

            if (type === 'area') {
                const regions = ['ì „êµ­','ì„œìš¸','ê²½ê¸°','ì¸ì²œ','ë¶€ì‚°','ëŒ€êµ¬','ëŒ€ì „','ê´‘ì£¼','ìš¸ì‚°','ì„¸ì¢…','ê°•ì›','ì¶©ë¶','ì¶©ë‚¨','ì „ë¶','ì „ë‚¨','ê²½ë¶','ê²½ë‚¨','ì œì£¼'];
                regions.forEach(region => {
                    const btn = document.createElement('div');
                    btn.className = 'filter-btn';
                    btn.innerText = region;
                    btn.onclick = async () => {
                        filters.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        container.innerHTML = '<p class="text-center text-gray-500 py-8">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
                        const adsCollection = collection(db, "ads");
                        const q = region === 'ì „êµ­'
                            ? query(adsCollection, orderBy("created_at", "desc"))
                            : query(adsCollection, where("region", "==", region), orderBy("created_at", "desc"));
                        try {
                            const querySnapshot = await getDocs(q);
                            renderAds(querySnapshot, container);
                        } catch(e) {
                            console.error("ì§€ì—­ë³„ ê´‘ê³  ë¡œë”© ì‹¤íŒ¨: ", e);
                            let errorMsg = '<p class="text-center text-red-500">ê´‘ê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                            if (e.code === 'failed-precondition') {
                                errorMsg += '<p class="text-center text-sm text-gray-600 mt-2">ì´ í•„í„°ë§ì„ ì‚¬ìš©í•˜ë ¤ë©´ Firestore ë°ì´í„°ë² ì´ìŠ¤ì— ìƒ‰ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê°œë°œì ì½˜ì†”(F12)ì„ ì—´ì–´ ì˜¤ë¥˜ ë©”ì‹œì§€ì— í¬í•¨ëœ ìƒ‰ì¸ ìƒì„± ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ìƒ‰ì¸ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.</p>'
                            }
                            container.innerHTML = errorMsg;
                        }
                    };
                    filters.appendChild(btn);
                });
                if (filters.querySelector('.filter-btn')) filters.querySelector('.filter-btn').click();
            } else if (type === 'type') {
                const loanTypes = [['ğŸ¢','ì†Œì•¡ëŒ€ì¶œ'],['ğŸ‘¨â€ğŸ’¼','ì§ì¥ì¸'],['ğŸ›ï¸','ì‚¬ì—…ì'],['ğŸ“ˆ','ì €ì‹ ìš©'],['ğŸ“…','ë‹¹ì¼ëŒ€ì¶œ']];
                loanTypes.forEach(([emoji, typeName]) => {
                    const btn = document.createElement('div');
                    btn.className = 'filter-btn';
                    btn.innerHTML = `<span>${emoji}</span><span>${typeName}</span>`;
                    btn.onclick = async () => {
                        filters.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        container.innerHTML = '<p class="text-center text-gray-500 py-8">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
                        const adsCollection = collection(db, "ads");
                        const q = query(adsCollection, where("loan_type", "==", typeName), orderBy("created_at", "desc"));
                        try {
                            const querySnapshot = await getDocs(q);
                            renderAds(querySnapshot, container);
                        } catch(e) {
                            console.error("ì¢…ë¥˜ë³„ ê´‘ê³  ë¡œë”© ì‹¤íŒ¨: ", e);
                            let errorMsg = '<p class="text-center text-red-500">ê´‘ê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                            if (e.code === 'failed-precondition') {
                                errorMsg += '<p class="text-center text-sm text-gray-600 mt-2">ì´ í•„í„°ë§ì„ ì‚¬ìš©í•˜ë ¤ë©´ Firestore ë°ì´í„°ë² ì´ìŠ¤ì— ìƒ‰ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê°œë°œì ì½˜ì†”(F12)ì„ ì—´ì–´ ì˜¤ë¥˜ ë©”ì‹œì§€ì— í¬í•¨ëœ ìƒ‰ì¸ ìƒì„± ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ìƒ‰ì¸ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”.</p>'
                            }
                            container.innerHTML = errorMsg;
                        }
                    };
                    filters.appendChild(btn);
                });
                if (filters.querySelector('.filter-btn')) filters.querySelector('.filter-btn').click();
            } else {
                filters.innerHTML = `
                    <div class="col-span-3 space-y-5 text-sm">
                        <div class="flex items-center">
                            <label class="w-24 font-bold text-gray-600">ëŒ€ì¶œê¸ˆì•¡</label>
                            <div class="flex-1 flex items-center bg-white border rounded-xl">
                                <input type="text" inputmode="numeric" id="loan-amount" placeholder="ê¸ˆì•¡ ì…ë ¥" class="w-full p-3 rounded-xl outline-none font-bold text-right">
                                <span class="px-4 text-gray-500 font-bold">ì›</span>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <label class="w-24 font-bold text-gray-600">ëŒ€ì¶œê¸°ê°„</label>
                            <div class="flex-1 flex items-center bg-white border rounded-xl">
                                <input type="number" id="loan-term" placeholder="ê¸°ê°„ ì…ë ¥" class="w-full p-3 rounded-xl outline-none font-bold text-right">
                                <div id="term-unit-selector" class="flex items-center p-1">
                                    <button data-unit="year" class="term-unit-btn bg-blue-600 text-white rounded-lg px-3 py-1 text-xs font-bold">ë…„</button>
                                    <button data-unit="month" class="term-unit-btn text-gray-500 rounded-lg px-3 py-1 text-xs font-bold">ì›”</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <label class="w-24 font-bold text-gray-600">ëŒ€ì¶œê¸ˆë¦¬</label>
                            <div class="flex-1 flex items-center bg-white border rounded-xl">
                                <input type="number" id="interest-rate" placeholder="ê¸ˆë¦¬ ì…ë ¥" class="w-full p-3 rounded-xl outline-none font-bold text-right">
                                <span class="px-4 text-gray-500 font-bold">%</span>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <label class="w-24 font-bold text-gray-600">ìƒí™˜ë°©ë²•</label>
                            <div id="repayment-method-selector" class="flex-1 grid grid-cols-3 gap-1 text-xs">
                                <button data-method="equal-installment" class="repayment-btn bg-blue-600 text-white p-3 rounded-lg font-bold">ì›ë¦¬ê¸ˆê· ë“±</button>
                                <button data-method="equal-principal" class="repayment-btn bg-white text-gray-600 p-3 rounded-lg font-bold border">ì›ê¸ˆê· ë“±</button>
                                <button data-method="bullet" class="repayment-btn bg-white text-gray-600 p-3 rounded-lg font-bold border">ë§Œê¸°ì¼ì‹œ</button>
                            </div>
                        </div>
                        <button onclick="calculateInterest()" class="w-full bg-blue-600 text-white py-4 mt-4 rounded-xl font-black shadow-lg">ê³„ì‚°í•˜ê¸°</button>
                    </div>
                `;
                container.innerHTML = `
                    <div id="calculator-result" class="text-center p-2 md:p-6"></div>
                    <div id="matching-ads-section" class="hidden pt-8">
                        <h3 class="text-xl font-black text-gray-900 mb-6 px-5 italic">ğŸ“ˆ ë§ì¶¤ ì¶”ì²œ ìƒí’ˆ</h3>
                        <div id="matching-ads-container" class="space-y-3"></div>
                    </div>
                `;
                
                // Add event listener for loan amount formatting
                document.getElementById('loan-amount').addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^0-9]/g, '');
                    if (value) {
                        e.target.value = parseInt(value, 10).toLocaleString();
                    } else {
                        e.target.value = '';
                    }
                });

                // Add event listeners for the new button groups
                document.querySelectorAll('.term-unit-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.term-unit-btn').forEach(b => {
                            b.classList.remove('bg-blue-600', 'text-white');
                            b.classList.add('text-gray-500');
                        });
                        btn.classList.add('bg-blue-600', 'text-white');
                        btn.classList.remove('text-gray-500');
                    });
                });

                document.querySelectorAll('.repayment-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.repayment-btn').forEach(b => {
                            b.classList.remove('bg-blue-600', 'text-white');
                            b.classList.add('bg-white', 'text-gray-600', 'border');
                        });
                        btn.classList.add('bg-blue-600', 'text-white');
                        btn.classList.remove('bg-white', 'text-gray-600', 'border');
                    });
                });
            }
        }

        async function displayMatchingAds(userAmount, userRate) {
            const section = document.getElementById('matching-ads-section');
            const container = document.getElementById('matching-ads-container');
            
            section.classList.remove('hidden');
            container.innerHTML = '<p class="text-center text-gray-500 py-8">ë§ì¶¤ ìƒí’ˆì„ ì°¾ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';

            try {
                const adsCollection = collection(db, "ads");
                const q = query(adsCollection, orderBy("created_at", "desc"));
                const querySnapshot = await getDocs(q);

                const matchingDocs = [];
                querySnapshot.forEach(doc => {
                    const ad = doc.data();
                    
                    const parseLimit = (limitStr) => {
                        if (!limitStr || typeof limitStr !== 'string') return 0;
                        const num = parseFloat(limitStr.replace(/[^0-9.]/g, ''));
                        if (isNaN(num)) return 0;
                        return limitStr.includes('ë§Œ') ? num * 10000 : num;
                    };

                    const parseRate = (rateStr) => {
                        if (!rateStr || typeof rateStr !== 'string') return Infinity;
                        const num = parseFloat(rateStr.replace(/[^0-9.]/g, ''));
                        return isNaN(num) ? Infinity : num;
                    };

                    const adLimit = parseLimit(ad.limit);
                    const adRate = parseRate(ad.yearly_rate);

                    if (userAmount <= adLimit) {
                        matchingDocs.push(doc);
                    }
                });

                const fakeSnapshot = {
                    empty: matchingDocs.length === 0,
                    forEach: (callback) => matchingDocs.forEach(callback)
                };
                
                renderAds(fakeSnapshot, container);

            } catch (e) {
                console.error("ë§ì¶¤ ìƒí’ˆ ê²€ìƒ‰ ì‹¤íŒ¨: ", e);
                container.innerHTML = '<p class="text-center text-red-500">ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }

        function calculateInterest() {
            const amount = parseFloat(document.getElementById('loan-amount').value.replace(/,/g, ''));
            const annualRate = parseFloat(document.getElementById('interest-rate').value);
            let term = parseInt(document.getElementById('loan-term').value);
            const resultDiv = document.getElementById('calculator-result');

            if (isNaN(amount) || isNaN(annualRate) || isNaN(term) || amount <= 0 || annualRate <= 0 || term <= 0) {
                resultDiv.innerHTML = '<p class="text-red-500 font-bold py-8">ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>';
                document.getElementById('matching-ads-section').classList.add('hidden');
                return;
            }

            const termUnit = document.querySelector('.term-unit-btn.bg-blue-600').dataset.unit;
            if (termUnit === 'year') {
                term = term * 12; // Convert years to months
            }

            const repaymentMethod = document.querySelector('.repayment-btn.bg-blue-600').dataset.method;
            const monthlyRate = annualRate / 100 / 12;
            let resultHTML = '';

            switch (repaymentMethod) {
                case 'equal-installment': { // ì›ë¦¬ê¸ˆê· ë“±
                    const monthlyPayment = (amount * monthlyRate * Math.pow(1 + monthlyRate, term)) / (Math.pow(1 + monthlyRate, term) - 1);
                    const totalPayment = monthlyPayment * term;
                    const totalInterest = totalPayment - amount;

                    resultHTML = `
                        <div class="space-y-2 text-left text-sm">
                            <p class="flex justify-between"><strong>ë§¤ì›” ìƒí™˜ê¸ˆ:</strong> <span class="font-mono font-bold">${Math.round(monthlyPayment).toLocaleString()}ì›</span></p>
                            <p class="flex justify-between text-gray-600"><strong>ì´ ëŒ€ì¶œì´ì:</strong> <span class="font-mono">${Math.round(totalInterest).toLocaleString()}ì›</span></p>
                            <p class="flex justify-between text-gray-600"><strong>ì´ ìƒí™˜ê¸ˆì•¡:</strong> <span class="font-mono">${Math.round(totalPayment).toLocaleString()}ì›</span></p>
                        </div>
                    `;
                    break;
                }
                case 'equal-principal': { // ì›ê¸ˆê· ë“±
                    const principalPayment = amount / term;
                    let totalInterest = 0;
                    let balance = amount;
                    
                    const firstMonthInterest = balance * monthlyRate;
                    const firstMonthPayment = principalPayment + firstMonthInterest;
                    
                    for (let i = 0; i < term; i++) {
                        totalInterest += balance * monthlyRate;
                        balance -= principalPayment;
                    }
                    const lastMonthPayment = principalPayment + (balance + principalPayment) * monthlyRate;
                    const totalPayment = amount + totalInterest;

                    resultHTML = `
                        <div class="space-y-2 text-left text-sm">
                            <p class="flex justify-between"><strong>ì›” ìƒí™˜ê¸ˆ:</strong> <span class="font-mono font-bold">${Math.round(firstMonthPayment).toLocaleString()}ì› ~ ${Math.round(lastMonthPayment).toLocaleString()}ì›</span></p>
                            <p class="text-xs text-gray-500">(íšŒì°¨ë³„ ìƒí™˜ ì›ê¸ˆì€ ë™ì¼, ì´ì ê°ì†Œ)</p>
                            <p class="flex justify-between text-gray-600 pt-2"><strong>ì´ ëŒ€ì¶œì´ì:</strong> <span class="font-mono">${Math.round(totalInterest).toLocaleString()}ì›</span></p>
                            <p class="flex justify-between text-gray-600"><strong>ì´ ìƒí™˜ê¸ˆì•¡:</strong> <span class="font-mono">${Math.round(totalPayment).toLocaleString()}ì›</span></p>
                        </div>
                    `;
                    break;
                }
                case 'bullet': { // ë§Œê¸°ì¼ì‹œ
                    const monthlyInterestPayment = amount * monthlyRate;
                    const totalInterest = monthlyInterestPayment * term;
                    const totalPayment = amount + totalInterest;

                    resultHTML = `
                        <div class="space-y-2 text-left text-sm">
                            <p class="flex justify-between"><strong>ë§¤ì›” ì´ì:</strong> <span class="font-mono font-bold">${Math.round(monthlyInterestPayment).toLocaleString()}ì›</span></p>
                            <p class="flex justify-between"><strong>ë§Œê¸° ìƒí™˜ì›ê¸ˆ:</strong> <span class="font-mono font-bold">${amount.toLocaleString()}ì›</span></p>
                            <p class="flex justify-between text-gray-600 pt-2"><strong>ì´ ëŒ€ì¶œì´ì:</strong> <span class="font-mono">${Math.round(totalInterest).toLocaleString()}ì›</span></p>
                            <p class="flex justify-between text-gray-600"><strong>ì´ ìƒí™˜ê¸ˆì•¡:</strong> <span class="font-mono">${Math.round(totalPayment).toLocaleString()}ì›</span></p>
                        </div>
                    `;
                    break;
                }
            }

            resultDiv.innerHTML = `
                <div class="bg-blue-50 p-6 rounded-2xl">
                    <h4 class="text-md font-black text-blue-700 mb-4">ì˜ˆìƒ ìƒí™˜ê¸ˆì•¡</h4>
                    ${resultHTML}
                </div>
                <p class="text-xs text-gray-400 mt-4 px-2">* ìœ„ ê²°ê³¼ëŠ” ë‹¨ìˆœ ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ëŒ€ì¶œ ìƒí’ˆ ë° ìƒí™˜ ë°©ì‹ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            `;
            
            displayMatchingAds(amount, annualRate);
        }

        async function submitAdInquiry() {
            const company = document.getElementById('ad-company').value.trim();
            const name = document.getElementById('ad-name').value.trim();
            const email = document.getElementById('ad-email').value.trim();
            const phone = document.getElementById('ad-phone').value.trim();
            const content = document.getElementById('ad-content').value.trim();

            if (!company || !name || !email || !phone || !content) {
                alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const newInquiry = {
                company,
                name,
                email,
                phone,
                content,
                status: 'pending',
                created_at: new Date()
            };

            try {
                const docRef = await addDoc(collection(db, "inquiries"), newInquiry);
                alert('ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('ad-company').value = '';
                document.getElementById('ad-name').value = '';
                document.getElementById('ad-email').value = '';
                document.getElementById('ad-phone').value = '';
                document.getElementById('ad-content').value = '';
            } catch (e) {
                console.error("ë¬¸ì˜ ë“±ë¡ ì‹¤íŒ¨: ", e);
                alert("ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ ë¬¸ì˜ë¥¼ ë“±ë¡í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: " + e.message);
            }
        }

        async function submitCsInquiry() {
            const title = document.getElementById('cs-title').value.trim();
            const content = document.getElementById('cs-content').value.trim();

            if (!title || !content) {
                alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const newInquiry = {
                title,
                content,
                status: 'pending',
                created_at: new Date()
            };

            try {
                const docRef = await addDoc(collection(db, "cs_inquiries"), newInquiry);
                alert('ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
                document.getElementById('cs-title').value = '';
                document.getElementById('cs-content').value = '';
            } catch (e) {
                console.error("ì‹¤ì‹œê°„ ë¬¸ì˜ ë“±ë¡ ì‹¤íŒ¨: ", e);
                alert("ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ ë¬¸ì˜ë¥¼ ë“±ë¡í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: " + e.message);
            }
        }
        
        async function loadAdsFromFirebase() {
            const adCon = document.getElementById('main-ads-container');
            if (!adCon) return;
            
            try {
                const adsCollection = collection(db, "ads");
                const q = query(adsCollection, orderBy("created_at", "desc"), firestoreLimit(3));
                const querySnapshot = await getDocs(q);
                renderAds(querySnapshot, adCon)
            } catch (e) {
                console.error("Firebaseì—ì„œ ê´‘ê³  ë¡œë”© ì‹¤íŒ¨: ", e);
                adCon.innerHTML = '<p class="col-span-3 text-center text-red-500">ê´‘ê³ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        function initMain() {
            loadAdsFromFirebase();
            const inqCon = document.getElementById('main-inquiry-container');
            if(!inqCon.innerHTML) {
                ["ê¸‰ì „ 300ë§Œì› ë‹¹ì¼ ê°€ëŠ¥?", "ì‚¬ì—…ì í•œë„ ë¬¸ì˜", "ì§ì¥ì¸ ì‹ ìš©ëŒ€ì¶œ", "ì €ì‹ ìš©ì 500ë§Œì›", "ë‹¹ì¼ëŒ€ì¶œ ì¡°ê±´ ë¬¸ì˜"].forEach(q => {
                    const d = document.createElement('div'); d.className = 'p-5 flex justify-between items-center';
                    d.innerHTML = `<div class="max-w-[70%]"><p class="truncate text-sm font-bold">${q}</p><span class="text-[10px] text-blue-600 font-black italic tracking-tighter">ìƒë‹´ëŒ€ê¸°</span></div><span class="text-[10px] text-gray-400 font-bold">ë°©ê¸ˆì „</span>`;
                    inqCon.appendChild(d);
                });
            }
        }

        window.showPage = showPage;
        window.updateSelection = updateSelection;
        window.calculateInterest = calculateInterest;
        window.toggleCategory = toggleCategory;
        window.submitAdInquiry = submitAdInquiry;
        window.submitCsInquiry = submitCsInquiry;
        // Initial page load handler
        window.onload = () => {
            const hash = window.location.hash.substring(1);
            if (hash) {
                const parts = hash.split('/');
                const pageId = parts[0];
                const detailId = parts[1] || null;
                showPage(pageId, detailId, false); // Do not push state again
            } else {
                showPage('main'); // Default to main page and push state
            }
        };

    </script>
        </div>

        <!-- Right Banner -->
        <div class="hidden lg:block w-[200px] flex-shrink-0 mx-4">
             <a href="https://www.bluestacks.com/ko/apps/action/penta-storm-on-pc.html" target="_blank" class="sticky top-10"><img src="https://wimg.sedaily.com/news/legacy/2017/03/21/1ODGIK0HWC_1.jpg" alt="Right Banner Ad" width="200" height="465"></a>
        </div>
    </div>
</body>
</html>